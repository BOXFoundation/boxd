version: "3.3"

services:
  p1:
    image: boxd:latest
    command: "./box start --config=./.devconfig/.box-1.yaml"
    ports:
      - "19199:19199"
      - "19191:19191"
      - "19190:19190"
    volumes:
      - ./.devconfig:/app/boxd/.devconfig
    networks:
      boxdnet:
        ipv4_address: 172.27.1.11

  p2:
    image: boxd:latest
    command: "./box start --config=./.devconfig/.box-2.yaml"
    depends_on:
      - p1
    ports:
      - "19189:19189"
      - "19181:19181"
      - "19180:19180"
    volumes:
      - ./.devconfig:/app/boxd/.devconfig
    networks:
      boxdnet:
        ipv4_address: 172.27.1.12

  p3:
    image: boxd:latest
    command: "./box start --config=./.devconfig/.box-3.yaml"
    depends_on:
      - p1
    ports:
      - "19179:19179"
      - "19171:19171"
      - "19170:19170"
    volumes:
      - ./.devconfig:/app/boxd/.devconfig
    networks:
      boxdnet:
        ipv4_address: 172.27.1.13

networks:
  boxdnet:
    ipam:
      driver: default
      config:
        - subnet: 172.27.1.0/24
